vars:

    mailer-queue: &mailer-queue https://sqs.{region}.amazonaws.com/{account}/cloud-custodian-mailer

    security-team-email: &security-team-email security-team@company.com

    s3-accounts-file: &s3-accounts-file s3://s3bucket/ValidAccountNumbers.csv



policies:


- name: aws-ami-cross-account-notify-pull
  resource: aws.ami
  metadata:
    category: [security/access-control]
    compliance:
      - type: CCM
        version: 3.0.1
        control-mappings: [IAM-07,IVS-08]
    creator: Stacklet
    severity: high
  description: |
    This policy will check for AWS AMIs which are either public facing or
    granting permissions to accounts outside of the organizations trusted
    accounts. Cross-account or public permissions should be restricted as they
    can allow unauthorized users to access your AMIs. These unauthorized
    permissions should be removed to meet AWS security best practices and secure
    your environment. A notification will be sent to the impacted users.
  filters:
    - type: cross-account
      whitelist_from:
          url: *s3-accounts-file
          format: csv2dict
  actions:
    - type: notify
      template: default.html
      priority_header: 1
      subject: "AWS AMI - Public or Cross-Account Permissions Present!! [custodian {{ account }} - {{ region }}]"
      to:
        - resource-owner
        - *security-team-email
      transport:
        type: sqs
        queue: *mailer-queue
        region: {region}





- name: aws-artifact-domain-cross-account-notify-pull
  resource: aws.artifact-domain
  metadata:
    category: [security/access-control]
    compliance:
      - type: CCM
        version: 3.0.1
        control-mappings: [IAM-07,IVS-08]
    creator: Stacklet
    severity: high
  description: |
    This policy will check for AWS artifact domains which are either public facing or
    granting permissions to accounts outside of the organizations trusted
    accounts. Cross-account or public permissions should be restricted as they
    can allow unauthorized users to access your artifact domains. These unauthorized
    permissions should be removed to meet AWS security best practices and secure
    your environment. A notification will be sent to the impacted users.
  filters:
    - type: cross-account
      whitelist_from:
          url: *s3-accounts-file
          format: csv2dict
  actions:
    - type: notify
      template: default.html
      priority_header: 1
      subject: "AWS Artifact Domain - Public or Cross-Account Permissions Present!! [custodian {{ account }} - {{ region }}]"
      to:
        - resource-owner
        - *security-team-email
      transport:
        type: sqs
        queue: *mailer-queue
        region: {region}





- name: aws-artifact-repo-cross-account-notify-pull
  resource: aws.artifact-repo
  metadata:
    category: [security/access-control]
    compliance:
      - type: CCM
        version: 3.0.1
        control-mappings: [IAM-07,IVS-08]
    creator: Stacklet
    severity: high
  description: |
    This policy will check for artifact repositories which are either public facing or
    granting permissions to accounts outside of the organizations trusted
    accounts. Cross-account or public permissions should be restricted as they
    can allow unauthorized users to access your artifact repositories These unauthorized
    permissions should be removed to meet AWS security best practices and secure
    your environment. A notification will be sent to the impacted users.
  filters:
    - type: cross-account
      whitelist_from:
          url: *s3-accounts-file
          format: csv2dict
  actions:
    - type: notify
      template: default.html
      priority_header: 1
      subject: "AWS Artifact Repository - Public or Cross-Account Permissions Present!! [custodian {{ account }} - {{ region }}]"
      to:
        - resource-owner
        - *security-team-email
      transport:
        type: sqs
        queue: *mailer-queue
        region: {region}





- name: aws-catalog-portfolio-cross-account-notify-pull
  resource: aws.catalog-portfolio
  metadata:
    category: [security/access-control]
    compliance:
      - type: CCM
        version: 3.0.1
        control-mappings: [IAM-07,IVS-08]
    creator: Stacklet
    severity: high
  description: |
    This policy will check for AWS Catalog Portfolios which are either public facing or
    granting permissions to accounts outside of the organizations trusted
    accounts. Cross-account or public permissions should be restricted as they
    can allow unauthorized users to access your Catalog Portfolios These unauthorized
    permissions should be removed to meet AWS security best practices and secure
    your environment. A notification will be sent to the impacted users.
  filters:
    - type: cross-account
      whitelist_from:
          url: *s3-accounts-file
          format: csv2dict
  actions:
    - type: notify
      template: default.html
      priority_header: 1
      subject: "AWS Catalog Portfolio - Public or Cross-Account Permissions Present!! [custodian {{ account }} - {{ region }}]"
      to:
        - resource-owner
        - *security-team-email
      transport:
        type: sqs
        queue: *mailer-queue
        region: {region}






- name: aws-config-recorder-cross-account-notify-pull
  resource: aws.config-recorder
  metadata:
    category: [security/access-control]
    compliance:
      - type: CCM
        version: 3.0.1
        control-mappings: [IAM-07,IVS-08]
    creator: Stacklet
    severity: high
  description: |
    This policy will check for AWS Config Recorders which are either public facing or
    granting permissions to accounts outside of the organizations trusted
    accounts. Cross-account or public permissions should be restricted as they
    can allow unauthorized users to access your Config Recorders These unauthorized
    permissions should be removed to meet AWS security best practices and secure
    your environment. A notification will be sent to the impacted users.
  filters:
    - type: cross-account
      whitelist_from:
          url: *s3-accounts-file
          format: csv2dict
  actions:
    - type: notify
      template: default.html
      priority_header: 1
      subject: "AWS Config Recorder - Public or Cross-Account Permissions Present!! [custodian {{ account }} - {{ region }}]"
      to:
        - resource-owner
        - *security-team-email
      transport:
        type: sqs
        queue: *mailer-queue
        region: {region}






- name: aws-ebs-snapshot-cross-account-notify-pull
  resource: aws.ebs-snapshot
  metadata:
    category: [security/access-control]
    compliance:
      - type: CCM
        version: 3.0.1
        control-mappings: [IAM-07,IVS-08]
    creator: Stacklet
    severity: high
  description: |
    This policy will check for AWS EBS snapshots which are either public facing or
    granting permissions to accounts outside of the organizations trusted
    accounts. Cross-account or public permissions should be restricted as they
    can allow unauthorized users to access your EBS snapshots. These unauthorized
    permissions should be removed to meet AWS security best practices and secure
    your environment. A notification will be sent to the impacted users.
  filters:
    - type: cross-account
      whitelist_from:
          url: *s3-accounts-file
          format: csv2dict
  actions:
    - type: notify
      template: default.html
      priority_header: 1
      subject: "AWS EBS Snapshot - Public or Cross-Account Permissions Present!! [custodian {{ account }} - {{ region }}]"
      to:
        - resource-owner
        - *security-team-email
      transport:
        type: sqs
        queue: *mailer-queue
        region: {region}







- name: aws-ecr-cross-account-notify-pull
  resource: aws.ecr
  metadata:
    category: [security/access-control]
    compliance:
      - type: CCM
        version: 3.0.1
        control-mappings: [IAM-07,IVS-08]
    creator: Stacklet
    severity: high
  description: |
    This policy will check for AWS ECR registry which are either public facing or
    granting permissions to accounts outside of the organizations trusted
    accounts. Cross-account or public permissions should be restricted as they
    can allow unauthorized users to access your ECR registry. These unauthorized
    permissions should be removed to meet AWS security best practices and secure
    your environment. A notification will be sent to the impacted users.
  filters:
    - type: cross-account
      whitelist_from:
          url: *s3-accounts-file
          format: csv2dict
  actions:
    - type: notify
      template: default.html
      priority_header: 1
      subject: "AWS ECR Registry - Public or Cross-Account Permissions Present!! [custodian {{ account }} - {{ region }}]"
      to:
        - resource-owner
        - *security-team-email
      transport:
        type: sqs
        queue: *mailer-queue
        region: {region}








- name: aws-elasticsearch-cross-account-notify-pull
  resource: aws.elasticsearch
  metadata:
    category: [security/access-control]
    compliance:
      - type: CCM
        version: 3.0.1
        control-mappings: [IAM-07,IVS-08]
    creator: Stacklet
    severity: high
  description: |
    This policy will check for AWS Elasticsearch Domains which are either public facing or
    granting permissions to accounts outside of the organizations trusted
    accounts. Cross-account or public permissions should be restricted as they
    can allow unauthorized users to access your Elasticsearch Domains. These unauthorized
    permissions should be removed to meet AWS security best practices and secure
    your environment. A notification will be sent to the impacted users.
  filters:
    - type: cross-account
      whitelist_from:
          url: *s3-accounts-file
          format: csv2dict
  actions:
    - type: notify
      template: default.html
      priority_header: 1
      subject: "AWS Elasticsearch Domain - Public or Cross-Account Permissions Present!! [custodian {{ account }} - {{ region }}]"
      to:
        - resource-owner
        - *security-team-email
      transport:
        type: sqs
        queue: *mailer-queue
        region: {region}








- name: aws-event-bus-cross-account-notify-pull
  resource: aws.event-bus
  metadata:
    category: [security/access-control]
    compliance:
      - type: CCM
        version: 3.0.1
        control-mappings: [IAM-07,IVS-08]
    creator: Stacklet
    severity: high
  description: |
    This policy will check for AWS Event Busses which are either public facing or
    granting permissions to accounts outside of the organizations trusted
    accounts. Cross-account or public permissions should be restricted as they
    can allow unauthorized users to access your Event Busses. These unauthorized
    permissions should be removed to meet AWS security best practices and secure
    your environment. A notification will be sent to the impacted users.
  filters:
    - type: cross-account
      whitelist_from:
          url: *s3-accounts-file
          format: csv2dict
  actions:
    - type: notify
      template: default.html
      priority_header: 1
      subject: "AWS Event Bus - Public or Cross-Account Permissions Present!! [custodian {{ account }} - {{ region }}]"
      to:
        - resource-owner
        - *security-team-email
      transport:
        type: sqs
        queue: *mailer-queue
        region: {region}







- name: aws-event-rule-target-cross-account-notify-pull
  resource: aws.event-rule-target
  metadata:
    category: [security/access-control]
    compliance:
      - type: CCM
        version: 3.0.1
        control-mappings: [IAM-07,IVS-08]
    creator: Stacklet
    severity: high
  description: |
    This policy will check for AWS Event Rule targets which are either public facing or
    granting permissions to accounts outside of the organizations trusted
    accounts. Cross-account or public permissions should be restricted as they
    can allow unauthorized users to access your Event Rule targets. These unauthorized
    permissions should be removed to meet AWS security best practices and secure
    your environment. A notification will be sent to the impacted users.
  filters:
    - type: cross-account
      whitelist_from:
          url: *s3-accounts-file
          format: csv2dict
  actions:
    - type: notify
      template: default.html
      priority_header: 1
      subject: "AWS Event Rule Target - Public or Cross-Account Permissions Present!! [custodian {{ account }} - {{ region }}]"
      to:
        - resource-owner
        - *security-team-email
      transport:
        type: sqs
        queue: *mailer-queue
        region: {region}






- name: aws-glacier-cross-account-notify-pull
  resource: aws.glacier
  metadata:
    category: [security/access-control]
    compliance:
      - type: CCM
        version: 3.0.1
        control-mappings: [IAM-07,IVS-08]
    creator: Stacklet
    severity: high
  description: |
    This policy will check for AWS Glacier Vaults which are either public facing or
    granting permissions to accounts outside of the organizations trusted
    accounts. Cross-account or public permissions should be restricted as they
    can allow unauthorized users to access your Glacier Vaults. These unauthorized
    permissions should be removed to meet AWS security best practices and secure
    your environment. A notification will be sent to the impacted users.
  filters:
    - type: cross-account
      whitelist_from:
          url: *s3-accounts-file
          format: csv2dict
  actions:
    - type: notify
      template: default.html
      priority_header: 1
      subject: "AWS Glacier Vault - Public or Cross-Account Permissions Present!! [custodian {{ account }} - {{ region }}]"
      to:
        - resource-owner
        - *security-team-email
      transport:
        type: sqs
        queue: *mailer-queue
        region: {region}







- name: aws-glue-catalog-cross-account-notify-pull
  resource: aws.glue-catalog
  metadata:
    category: [security/access-control]
    compliance:
      - type: CCM
        version: 3.0.1
        control-mappings: [IAM-07,IVS-08]
    creator: Stacklet
    severity: high
  description: |
    This policy will check for AWS Glue Catalogs which are either public facing or
    granting permissions to accounts outside of the organizations trusted
    accounts. Cross-account or public permissions should be restricted as they
    can allow unauthorized users to access your Glue Catalogs. These unauthorized
    permissions should be removed to meet AWS security best practices and secure
    your environment. A notification will be sent to the impacted users.
  filters:
    - type: cross-account
      whitelist_from:
          url: *s3-accounts-file
          format: csv2dict
  actions:
    - type: notify
      template: default.html
      priority_header: 1
      subject: "AWS Glue Catalog - Public or Cross-Account Permissions Present!! [custodian {{ account }} - {{ region }}]"
      to:
        - resource-owner
        - *security-team-email
      transport:
        type: sqs
        queue: *mailer-queue
        region: {region}






- name: aws-iam-role-cross-account-notify-pull
  resource: aws.iam-role
  metadata:
    category: [security/access-control]
    compliance:
      - type: CCM
        version: 3.0.1
        control-mappings: [IAM-07,IVS-08]
    creator: Stacklet
    severity: high
  description: |
    This policy will check for AWS IAM Roles which are either public facing or
    granting permissions to accounts outside of the organizations trusted
    accounts. Cross-account or public permissions should be restricted as they
    can allow unauthorized users to access your IAM Roles. These unauthorized
    permissions should be removed to meet AWS security best practices and secure
    your environment. A notification will be sent to the impacted users.
  filters:
    - type: cross-account
      whitelist_from:
          url: *s3-accounts-file
          format: csv2dict
  actions:
    - type: notify
      template: default.html
      priority_header: 1
      subject: "AWS IAM Role - Public or Cross-Account Permissions Present!! [custodian {{ account }} - {{ region }}]"
      to:
        - resource-owner
        - *security-team-email
      transport:
        type: sqs
        queue: *mailer-queue
        region: {region}






- name: aws-kms-cross-account-notify-pull
  resource: aws.kms
  metadata:
    category: [security/access-control]
    compliance:
      - type: CCM
        version: 3.0.1
        control-mappings: [IAM-07,IVS-08]
    creator: Stacklet
    severity: high
  description: |
    This policy will check for AWS KMS Keystores which are either public facing or
    granting permissions to accounts outside of the organizations trusted
    accounts. Cross-account or public permissions should be restricted as they
    can allow unauthorized users to access your KMS Keystores. These unauthorized
    permissions should be removed to meet AWS security best practices and secure
    your environment. A notification will be sent to the impacted users.
  filters:
    - type: cross-account
      whitelist_from:
          url: *s3-accounts-file
          format: csv2dict
  actions:
    - type: notify
      template: default.html
      priority_header: 1
      subject: "AWS KMS Keystore - Public or Cross-Account Permissions Present!! [custodian {{ account }} - {{ region }}]"
      to:
        - resource-owner
        - *security-team-email
      transport:
        type: sqs
        queue: *mailer-queue
        region: {region}






- name: aws-kms-key-cross-account-notify-pull
  resource: aws.kms-key
  metadata:
    category: [security/access-control]
    compliance:
      - type: CCM
        version: 3.0.1
        control-mappings: [IAM-07,IVS-08]
    creator: Stacklet
    severity: high
  description: |
    This policy will check for AWS KMS Keys which are either public facing or
    granting permissions to accounts outside of the organizations trusted
    accounts. Cross-account or public permissions should be restricted as they
    can allow unauthorized users to access your KMS Keys. These unauthorized
    permissions should be removed to meet AWS security best practices and secure
    your environment. A notification will be sent to the impacted users.
  filters:
    - type: cross-account
      whitelist_from:
          url: *s3-accounts-file
          format: csv2dict
  actions:
    - type: notify
      template: default.html
      priority_header: 1
      subject: "AWS KMS Key - Public or Cross-Account Permissions Present!! [custodian {{ account }} - {{ region }}]"
      to:
        - resource-owner
        - *security-team-email
      transport:
        type: sqs
        queue: *mailer-queue
        region: {region}






- name: aws-lambda-cross-account-notify-pull
  resource: aws.lambda
  metadata:
    category: [security/access-control]
    compliance:
      - type: CCM
        version: 3.0.1
        control-mappings: [IAM-07,IVS-08]
    creator: Stacklet
    severity: high
  description: |
    This policy will check for AWS Lambda functions which are either public facing or
    granting permissions to accounts outside of the organizations trusted
    accounts. Cross-account or public permissions should be restricted as they
    can allow unauthorized users to access your Lambda functions. These unauthorized
    permissions should be removed to meet AWS security best practices and secure
    your environment. A notification will be sent to the impacted users.
  filters:
    - type: cross-account
      whitelist_from:
          url: *s3-accounts-file
          format: csv2dict
  actions:
    - type: notify
      template: default.html
      priority_header: 1
      subject: "AWS Lambda Function - Public or Cross-Account Permissions Present!! [custodian {{ account }} - {{ region }}]"
      to:
        - resource-owner
        - *security-team-email
      transport:
        type: sqs
        queue: *mailer-queue
        region: {region}






- name: aws-lambda-layer-cross-account-notify-pull
  resource: aws.lambda-layer
  metadata:
    category: [security/access-control]
    compliance:
      - type: CCM
        version: 3.0.1
        control-mappings: [IAM-07,IVS-08]
    creator: Stacklet
    severity: high
  description: |
    This policy will check for AWS Lambda Layers which are either public facing or
    granting permissions to accounts outside of the organizations trusted
    accounts. Cross-account or public permissions should be restricted as they
    can allow unauthorized users to access your Lambda Layers. These unauthorized
    permissions should be removed to meet AWS security best practices and secure
    your environment. A notification will be sent to the impacted users.
  filters:
    - type: cross-account
      whitelist_from:
          url: *s3-accounts-file
          format: csv2dict
  actions:
    - type: notify
      template: default.html
      priority_header: 1
      subject: "AWS Lambda Layer - Public or Cross-Account Permissions Present!! [custodian {{ account }} - {{ region }}]"
      to:
        - resource-owner
        - *security-team-email
      transport:
        type: sqs
        queue: *mailer-queue
        region: {region}






- name: aws-log-group-cross-account-notify-pull
  resource: aws.log-group
  metadata:
    category: [security/access-control]
    compliance:
      - type: CCM
        version: 3.0.1
        control-mappings: [IAM-07,IVS-08]
    creator: Stacklet
    severity: high
  description: |
    This policy will check for AWS CloudWatch Log Groups which are either public facing or
    granting permissions to accounts outside of the organizations trusted
    accounts. Cross-account or public permissions should be restricted as they
    can allow unauthorized users to access your CloudWatch Log Groups. These unauthorized
    permissions should be removed to meet AWS security best practices and secure
    your environment. A notification will be sent to the impacted users.
  filters:
    - type: cross-account
      whitelist_from:
          url: *s3-accounts-file
          format: csv2dict
  actions:
    - type: notify
      template: default.html
      priority_header: 1
      subject: "AWS CloudWatch Log Group - Public or Cross-Account Permissions Present!! [custodian {{ account }} - {{ region }}]"
      to:
        - resource-owner
        - *security-team-email
      transport:
        type: sqs
        queue: *mailer-queue
        region: {region}








- name: aws-peering-connection-cross-account-notify-pull
  resource: aws.peering-connection
  metadata:
    category: [security/access-control]
    compliance:
      - type: CCM
        version: 3.0.1
        control-mappings: [IAM-07,IVS-08]
    creator: Stacklet
    severity: high
  description: |
    This policy will check for AWS Peering connections which are either public facing or
    granting permissions to accounts outside of the organizations trusted
    accounts. Cross-account or public permissions should be restricted as they
    can allow unauthorized users to access your Peering connections. These unauthorized
    permissions should be removed to meet AWS security best practices and secure
    your environment. A notification will be sent to the impacted users.
  filters:
    - type: cross-account
      whitelist_from:
          url: *s3-accounts-file
          format: csv2dict
  actions:
    - type: notify
      template: default.html
      priority_header: 1
      subject: "AWS Peering Connection - Public or Cross-Account Permissions Present!! [custodian {{ account }} - {{ region }}]"
      to:
        - resource-owner
        - *security-team-email
      transport:
        type: sqs
        queue: *mailer-queue
        region: {region}







- name: aws-rds-cluster-snapshot-cross-account-notify-pull
  resource: aws.rds-cluster-snapshot
  metadata:
    category: [security/access-control]
    compliance:
      - type: CCM
        version: 3.0.1
        control-mappings: [IAM-07,IVS-08]
    creator: Stacklet
    severity: high
  description: |
    This policy will check for AWS RDS Cluster Snapshots which are either public facing or
    granting permissions to accounts outside of the organizations trusted
    accounts. Cross-account or public permissions should be restricted as they
    can allow unauthorized users to access your RDS Cluster Snapshots. These unauthorized
    permissions should be removed to meet AWS security best practices and secure
    your environment. A notification will be sent to the impacted users.
  filters:
    - type: cross-account
      whitelist_from:
          url: *s3-accounts-file
          format: csv2dict
  actions:
    - type: notify
      template: default.html
      priority_header: 1
      subject: "AWS RDS Cluster Snapshot - Public or Cross-Account Permissions Present!! [custodian {{ account }} - {{ region }}]"
      to:
        - resource-owner
        - *security-team-email
      transport:
        type: sqs
        queue: *mailer-queue
        region: {region}






- name: aws-rds-snapshot-cross-account-notify-pull
  resource: aws.rds-snapshot
  metadata:
    category: [security/access-control]
    compliance:
      - type: CCM
        version: 3.0.1
        control-mappings: [IAM-07,IVS-08]
    creator: Stacklet
    severity: high
  description: |
    This policy will check for AWS RDS Snapshots which are either public facing or
    granting permissions to accounts outside of the organizations trusted
    accounts. Cross-account or public permissions should be restricted as they
    can allow unauthorized users to access your RDS Snapshots. These unauthorized
    permissions should be removed to meet AWS security best practices and secure
    your environment. A notification will be sent to the impacted users.
  filters:
    - type: cross-account
      whitelist_from:
          url: *s3-accounts-file
          format: csv2dict
  actions:
    - type: notify
      template: default.html
      priority_header: 1
      subject: "AWS RDS Snapshot - Public or Cross-Account Permissions Present!! [custodian {{ account }} - {{ region }}]"
      to:
        - resource-owner
        - *security-team-email
      transport:
        type: sqs
        queue: *mailer-queue
        region: {region}







- name: aws-redshift-snapshot-cross-account-notify-pull
  resource: aws.redshift-snapshot
  metadata:
    category: [security/access-control]
    compliance:
      - type: CCM
        version: 3.0.1
        control-mappings: [IAM-07,IVS-08]
    creator: Stacklet
    severity: high
  description: |
    This policy will check for AWS Redshift Snapshots which are either public facing or
    granting permissions to accounts outside of the organizations trusted
    accounts. Cross-account or public permissions should be restricted as they
    can allow unauthorized users to access your Redshift Snapshots. These unauthorized
    permissions should be removed to meet AWS security best practices and secure
    your environment. A notification will be sent to the impacted users.
  filters:
    - type: cross-account
      whitelist_from:
          url: *s3-accounts-file
          format: csv2dict
  actions:
    - type: notify
      template: default.html
      priority_header: 1
      subject: "AWS Redshift Snapshot - Public or Cross-Account Permissions Present!! [custodian {{ account }} - {{ region }}]"
      to:
        - resource-owner
        - *security-team-email
      transport:
        type: sqs
        queue: *mailer-queue
        region: {region}







- name: aws-rest-api-cross-account-notify-pull
  resource: aws.rest-api
  metadata:
    category: [security/access-control]
    compliance:
      - type: CCM
        version: 3.0.1
        control-mappings: [IAM-07,IVS-08]
    creator: Stacklet
    severity: high
  description: |
    This policy will check for AWS Rest APIs which are either public facing or
    granting permissions to accounts outside of the organizations trusted
    accounts. Cross-account or public permissions should be restricted as they
    can allow unauthorized users to access your Rest APIs. These unauthorized
    permissions should be removed to meet AWS security best practices and secure
    your environment. A notification will be sent to the impacted users.
  filters:
    - type: cross-account
      whitelist_from:
          url: *s3-accounts-file
          format: csv2dict
  actions:
    - type: notify
      template: default.html
      priority_header: 1
      subject: "AWS Rest API - Public or Cross-Account Permissions Present!! [custodian {{ account }} - {{ region }}]"
      to:
        - resource-owner
        - *security-team-email
      transport:
        type: sqs
        queue: *mailer-queue
        region: {region}







- name: aws-s3-cross-account-notify-pull
  resource: aws.s3
  metadata:
    category: [security/access-control]
    compliance:
      - type: CCM
        version: 3.0.1
        control-mappings: [IAM-07,IVS-08]
    creator: Stacklet
    severity: high
  description: |
    This policy will check for AWS S3 Buckets which are either public facing or
    granting permissions to accounts outside of the organizations trusted
    accounts. Cross-account or public permissions should be restricted as they
    can allow unauthorized users to access your S3 Buckets. These unauthorized
    permissions should be removed to meet AWS security best practices and secure
    your environment. A notification will be sent to the impacted users.
  filters:
    - type: cross-account
      whitelist_from:
          url: *s3-accounts-file
          format: csv2dict
  actions:
    - type: notify
      template: default.html
      priority_header: 1
      subject: "AWS S3 Bucket - Public or Cross-Account Permissions Present!! [custodian {{ account }} - {{ region }}]"
      to:
        - resource-owner
        - *security-team-email
      transport:
        type: sqs
        queue: *mailer-queue
        region: {region}






- name: aws-secrets-manager-cross-account-notify-pull
  resource: aws.secrets-manager
  metadata:
    category: [security/access-control]
    compliance:
      - type: CCM
        version: 3.0.1
        control-mappings: [IAM-07,IVS-08]
    creator: Stacklet
    severity: high
  description: |
    This policy will check for AWS Secrets Manager Secrets which are either public facing or
    granting permissions to accounts outside of the organizations trusted
    accounts. Cross-account or public permissions should be restricted as they
    can allow unauthorized users to access your Secrets Manager Secrets. These unauthorized
    permissions should be removed to meet AWS security best practices and secure
    your environment. A notification will be sent to the impacted users.
  filters:
    - type: cross-account
      whitelist_from:
          url: *s3-accounts-file
          format: csv2dict
  actions:
    - type: notify
      template: default.html
      priority_header: 1
      subject: "AWS Secrets Manager - Public or Cross-Account Permissions Present!! [custodian {{ account }} - {{ region }}]"
      to:
        - resource-owner
        - *security-team-email
      transport:
        type: sqs
        queue: *mailer-queue
        region: {region}






- name: aws-serverless-app-cross-account-notify-pull
  resource: aws.serverless-app
  metadata:
    category: [security/access-control]
    compliance:
      - type: CCM
        version: 3.0.1
        control-mappings: [IAM-07,IVS-08]
    creator: Stacklet
    severity: high
  description: |
    This policy will check for AWS Serverless applications which are either public facing or
    granting permissions to accounts outside of the organizations trusted
    accounts. Cross-account or public permissions should be restricted as they
    can allow unauthorized users to access your Serverless applications. These unauthorized
    permissions should be removed to meet AWS security best practices and secure
    your environment. A notification will be sent to the impacted users.
  filters:
    - type: cross-account
      whitelist_from:
          url: *s3-accounts-file
          format: csv2dict
  actions:
    - type: notify
      template: default.html
      priority_header: 1
      subject: "AWS Serverless Application - Public or Cross-Account Permissions Present!! [custodian {{ account }} - {{ region }}]"
      to:
        - resource-owner
        - *security-team-email
      transport:
        type: sqs
        queue: *mailer-queue
        region: {region}





- name: aws-sns-cross-account-notify-pull
  resource: aws.sns
  metadata:
    category: [security/access-control]
    compliance:
      - type: CCM
        version: 3.0.1
        control-mappings: [IAM-07,IVS-08]
    creator: Stacklet
    severity: high
  description: |
    This policy will check for AWS SNS Topics which are either public facing or
    granting permissions to accounts outside of the organizations trusted
    accounts. Cross-account or public permissions should be restricted as they
    can allow unauthorized users to access your SNS Topics. These unauthorized
    permissions should be removed to meet AWS security best practices and secure
    your environment. A notification will be sent to the impacted users.
  filters:
    - type: cross-account
      whitelist_from:
          url: *s3-accounts-file
          format: csv2dict
  actions:
    - type: notify
      template: default.html
      priority_header: 1
      subject: "AWS SNS Topic - Public or Cross-Account Permissions Present!! [custodian {{ account }} - {{ region }}]"
      to:
        - resource-owner
        - *security-team-email
      transport:
        type: sqs
        queue: *mailer-queue
        region: {region}





- name: aws-sqs-cross-account-notify-pull
  resource: aws.sqs
  metadata:
    category: [security/access-control]
    compliance:
      - type: CCM
        version: 3.0.1
        control-mappings: [IAM-07,IVS-08]
    creator: Stacklet
    severity: high
  description: |
    This policy will check for AWS SQS queues which are either public facing or
    granting permissions to accounts outside of the organizations trusted
    accounts. Cross-account or public permissions should be restricted as they
    can allow unauthorized users to access your SQS queues. These unauthorized
    permissions should be removed to meet AWS security best practices and secure
    your environment. A notification will be sent to the impacted users.
  filters:
    - type: cross-account
      whitelist_from:
          url: *s3-accounts-file
          format: csv2dict
  actions:
    - type: notify
      template: default.html
      priority_header: 1
      subject: "AWS SQS Queue - Public or Cross-Account Permissions Present!! [custodian {{ account }} - {{ region }}]"
      to:
        - resource-owner
        - *security-team-email
      transport:
        type: sqs
        queue: *mailer-queue
        region: {region}






- name: aws-vpc-endpoint-cross-account-notify-pull
  resource: aws.vpc-endpoint
  metadata:
    category: [security/access-control]
    compliance:
      - type: CCM
        version: 3.0.1
        control-mappings: [IAM-07,IVS-08]
    creator: Stacklet
    severity: high
  description: |
    This policy will check for AWS VPC endpoints which are either public facing or
    granting permissions to accounts outside of the organizations trusted
    accounts. Cross-account or public permissions should be restricted as they
    can allow unauthorized users to access your VPC endpoints. These unauthorized
    permissions should be removed to meet AWS security best practices and secure
    your environment. A notification will be sent to the impacted users.
  filters:
    - type: cross-account
      whitelist_from:
          url: *s3-accounts-file
          format: csv2dict
  actions:
    - type: notify
      template: default.html
      priority_header: 1
      subject: "AWS VPC Endpoint - Public or Cross-Account Permissions Present!! [custodian {{ account }} - {{ region }}]"
      to:
        - resource-owner
        - *security-team-email
      transport:
        type: sqs
        queue: *mailer-queue
        region: {region}
